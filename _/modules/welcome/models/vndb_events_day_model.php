<?php

if (!defined('BASEPATH'))
    exit('No direct script access allowed');

/* * *******************************************************************************************************************
 * Client  Name ：  IFRC
 * ---------------------------------------------------------------------------------------------------------------------
 * Project Name ：  IMS v3.0
 * ---------------------------------------------------------------------------------------------------------------------
 * File Name    ：  home.php 
 * ---------------------------------------------------------------------------------------------------------------------
 * Entry Server ：
 * ---------------------------------------------------------------------------------------------------------------------
 * Called By    ：  System
 * ---------------------------------------------------------------------------------------------------------------------
 * Notice       ：
 * ---------------------------------------------------------------------------------------------------------------------
 * Copyright    ：  IFRC
 * ---------------------------------------------------------------------------------------------------------------------
 * Comment      ：
 * ---------------------------------------------------------------------------------------------------------------------
 * History      ：
 * ---------------------------------------------------------------------------------------------------------------------
 * Version V003 ：  2013.07.18 (Nguyen Tuan Anh)        Update
 * ******************************************************************************************************************* */

class Vndb_events_day_model extends CI_Model {

    public $vndb_events_day = "vndb_events_day";

    function __construct() {
        parent::__construct();
    }

    /*     * ***********************************************************************************************************
     * Name         ： getNews
     * -----------------------------------------------------------------------------------------------------------------
     * Description  ：
     * -----------------------------------------------------------------------------------------------------------------
     * Params       ： $code
     * -----------------------------------------------------------------------------------------------------------------
     * Return       ：
     * -----------------------------------------------------------------------------------------------------------------
     * Warning      ：
     * -----------------------------------------------------------------------------------------------------------------
     * Copyright    ： IFRC
     * -----------------------------------------------------------------------------------------------------------------
     * M001         ： Update  2013.08.15 (Vu KHai)
     * *************************************************************************************************************** */

    public function getNews($code) {
        $sql = "SELECT {$this->vndb_events_day}.ticker, {$this->vndb_events_day}.date_ann, {$this->vndb_events_day}.event_type, {$this->vndb_events_day}.evname, {$this->vndb_events_day}.content
                FROM {$this->vndb_events_day} JOIN idx_compo
                ON {$this->vndb_events_day}.ticker = idx_compo.stk_code AND idx_compo.idx_code = '$code'
                WHERE {$this->vndb_events_day}.status = 'CONFIRM'";
        $output = $this->db->query($sql)->result_array();
        $result = array();
        foreach ($output as $key => $item) {
            $row = array();
            foreach ($item as $k => $v) {
                $value = $item[$k];
                if ($k == 'content') {
                    $value = htmlspecialchars(substr(strip_tags(html_entity_decode($item['content'])), 0, 70)) . '... <a header="' . $item['ticker'] . ':' . $item['date_ann'] . '" href="javascript:void(0)" content="' . $item['content'] . '" class="view-more">view more</a>';
                }
                $row[$k] = $value;
            }
            $result[] = $row;
        }
        return $result;
    }

}